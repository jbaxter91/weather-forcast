<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Widget</title>

    <!-- Resources -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="./assets/styles/style.css" />

</head>
<body>

    <div class="container-fluid mx-0">
        
        <!-- Header -->
        <div class="row bg-dark">
            <header class="col text-center">
                Weather Dashboard
            </header>
        </div>

        <!-- Main row containing aside and stacked display info -->
        <main class="row mt-4 mx-2 ml-0">
            <!-- Large screen display for search and hotkey aka 'aside' -->
            <!-- This only displays for screens larger than medium -->
            <div class="col-2 border mx-3 my-1 d-none d-lg-block">
                <h2 class="smallerH2 text-center">
                    Search for a city:
                </h2>
                <div class="row mx-1">
                    <input id="input-large" type="text" placeholder="Search.." name="search" class="col mr-1">
                    <button class="btn-primary" type="submit"><i class="fa fa-search"></i></button>
                </div>
                
                <button onclick="GetWeather('Citrus Heights')" class="col-12 my-2 btn btn-primary btn-lg btn-block"> Citrus Heights</button>
                <button onclick="GetWeather('Sacramento')" class="col-12 my-2 btn btn-primary btn-lg btn-block"> Sacramento</button>
                <button onclick="GetWeather('Roseville')" class="col-12 my-2 btn btn-primary btn-lg btn-block"> Roseville</button>
                <button onclick="GetWeather('New York')" class="col-12 my-2 btn btn-primary btn-lg btn-block"> New York</button>
                <button  onclick="GetWeather('Los Angeles')" class="col-12 my-2 btn btn-primary btn-lg btn-block"> Los Angeles</button>
                <button  onclick="GetWeather('Las Vegas')" class="col-12 my-2 btn btn-primary btn-lg btn-block"> Las Vegas</button>
            </div>
            <!-- Small screen display for controls -->
            <!-- This only displays for screens smaller than large -->
            <div class="col-12 border d-lg-none">
                <h2>
                    Search for a city:
                </h2>
                <div class="row mx-1">
                    <input id="input-small" type="text" placeholder="Search.." name="search" class="col mr-1">
                    <button class="btn-primary" type="submit"><i class="fa fa-search"></i></button>
                </div>
                <div class="row px-3">
                    <button onclick="GetWeather('Citrus Heights')" class="col mx-1 my-2 btn btn-primary btn-lg btn-block"> Citrus Heights</button>
                    <button onclick="GetWeather('Sacramento')" class=" col mx-1 my-2 btn btn-primary btn-lg btn-block"> Sacramento</button>
                    <button onclick="GetWeather('Roseville')" class="col mx-1 my-2 btn btn-primary btn-lg btn-block"> Roseville</button>
                    <button onclick="GetWeather('New York')" class="col mx-1 my-2 btn btn-primary btn-lg btn-block"> New York</button>
                </div>
                
            </div>

            <!-- Container For Current Forcast -->
            
            <div class="col">
                <div class="row mt-1">
                    <div id="day-today" class="col-12 border mb-2">
                        <h3>
                            Location (Date)
                            <div id="icon"><img id="wicon" alt="Weather icon"></div>
                        </h3>
                        <p>
                            Temp
                        </p>
                        <p>
                            Humidity
                        </p>
                        <p>
                            Wind Speed
                        </p>
                        <p>
                            UV Index
                        </p>
                    </div>

                    <div class="col-12 mb-2">
                        <h3>
                            5 Day Forcast
                        </h3>
                        <!-- 5 day forcast container -->
                        <div class="row">
                            <div id="day-1" class="col-12 col-sm-4 col-md-2 my-2 mx-1 border border-primary" style="display: none;">
                                <h3>
                                    date
                                </h3>
                                <p>
                                    image
                                </p>
                                <p>
                                    temp
                                </p>
                                <p>
                                    humidity
                                </p>
                            </div>
                            <div id="day-2" class="col-12 col-sm-4 col-md-2 my-2 mx-1 border border-primary" style="display: none;">
                                <h3>
                                    date
                                </h3>
                                <p>
                                    image
                                </p>
                                <p>
                                    temp
                                </p>
                                <p>
                                    humidity
                                </p>
                            </div>
                            <div id="day-3" class="col-12 col-sm-4 col-md-2 my-2 mx-1 border border-primary " style="display: none;">
                                <h3>
                                    date
                                </h3>
                                <p>
                                    image
                                </p>
                                <p>
                                    temp
                                </p>
                                <p>
                                    humidity
                                </p>
                            </div>
                            <div id="day-4" class="col-12 col-sm-4 col-md-2 my-2 mx-1 border border-primary " style="display: none;">
                                <h3>
                                    date
                                </h3>
                                <p>
                                    image
                                </p>
                                <p>
                                    temp
                                </p>
                                <p>
                                    humidity
                                </p>
                            </div>
                            <div id="day-5" class="col-12 col-sm-4 col-md-2 my-2 mx-1 border border-primary" style="display: none;">
                                <h3>
                                    date
                                </h3>
                                <p>
                                    image
                                </p>
                                <p>
                                    temp
                                </p>
                                <p>
                                    humidity
                                </p>
                            </div>
                            
                        </div>
                    </div>

                </div>
            </div>
        </main>

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="./assets/scripts/script.js"></script>

    <script type="text/javascript">

        const INPUT_SMALL = $("#input-small");
        const INPUT_LARGE = $("#input-large");
        const DAY_TODAY = $("#day-today");
        const DAY_ONE = $("#day-1");
        const DAY_TWO = $("#day-2");
        const DAY_THREE = $("#day-3");
        const DAY_FOUR = $("#day-4");
        const DAY_FIVE = $("#day-5");

        const BASE_URL = "https://api.openweathermap.org/data/2.5/forecast/daily?q=";
        const API_KEY = "&cnt=6&appid=166a433c57516f51dfab1f7edaed8413";


        // ===== Functions to keep the two search boxes in sync ======
        INPUT_SMALL.change(function()
        {
            console.log("Updating Input For large");
            INPUT_LARGE.val(INPUT_SMALL.val());
            GetWeather(INPUT_LARGE.val());
        });
        INPUT_LARGE.change(function()
        {
            console.log("Updating Input For small");
            INPUT_SMALL.val(INPUT_LARGE.val());
            GetWeather(INPUT_LARGE.val());
        });
        // ===========================================================

        function GetWeather(searchTerm)
        {
            var queryURL = BASE_URL + searchTerm + API_KEY;
            // Here we run our AJAX call to the OpenWeatherMap API
            $.ajax({
            url: queryURL,
            method: "GET"
            })
            // We store all of the retrieved data inside of an object called "response"
            .then(function(response) {

                // Log the resulting object
                console.log(response);
                
                UpdateTodayDisplay(response);
                UpdateFiveDayDisplay(response);
                UpdateUvDisplay(response.city.coord.lat, response.city.coord.lon);
               
            });
        }

        function UpdateTodayDisplay(response)
        {
            
            var iconCode = response.list[0].weather[0].icon;
            var iconURL = "http://openweathermap.org/img/w/" + iconCode + ".png";
            var iconElement = $("<img>",
            {
                src: iconURL,
                alt: "Todays Weather Icon"
            })
            $(DAY_TODAY.children()[0]).text(response.city.name +" " + ConvertDate(response.list[0].dt) + " ").append(iconElement);

            $(DAY_TODAY.children()[1]).text("Temperature: " + ConvertToF(response.list[0].temp.day) + " (F)");

            $(DAY_TODAY.children()[2]).text("Humidity: " + response.list[0].humidity + " %");

            $(DAY_TODAY.children()[3]).text("Wind Speed: " + response.list[0].speed + " MPH");

            $(DAY_TODAY.children()[4]).text("UV INDEX");
 
        }

        function UpdateFiveDayDisplay(response)
        {
            var days = [DAY_ONE, DAY_TWO, DAY_THREE, DAY_FOUR, DAY_FIVE];
            for(var i=0; i < days.length;i++)
            {
                days[i].attr("style", "display:block");
                // This will loop over all our days to display
                var targetDay = response.list[i+1];
                $(days[i].children()[0]).text(ConvertDate(targetDay.dt));
                $(days[i].children()[1]).text("ICON:");
                $(days[i].children()[2]).text("Temp: " + ConvertToF( targetDay.temp.day) + " (F)");
                $(days[i].children()[3]).text("Humidity: " + targetDay.humidity + "%");
            }
            
        }

        function UpdateUvDisplay(lat, lon)
        {
            var queryURL = "http://api.openweathermap.org/data/2.5/uvi?appid=" + API_KEY + "&lat=" + lat +"&lon=" + lon;
            // Here we run our AJAX call to the OpenWeatherMap API
            $.ajax({
            url: queryURL,
            method: "GET"
            })
            // We store all of the retrieved data inside of an object called "response"
            .then(function(response) {

                // Log the resulting object
                console.log(response);
                
               
            });
        }

        // Function to extract the conversion of kelvin to farenheight
        // Returns value only, no symbol, also fixed 2
        function ConvertToF(tempKelvin)
        {
            return ((tempKelvin - 273.15) * 1.80 + 32).toFixed(2);
        }

        // Function to convert unix timestamp to formatted date
        function ConvertDate(unixDate)
        {
            var date = new Date(unixDate * 1000);
            return (date.getMonth()+1) + "/" + date.getDate() + "/" + date.getFullYear();
        }
        

    </script>
    
</body>
</html>